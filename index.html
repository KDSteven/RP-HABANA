<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>R.P Habana - Inventory System</title>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { height: 100vh; }
    .left-section {
      background-color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      background: url('img/ser.jpg') center/cover no-repeat;
    }
    .left-section h1 { color: #f39200; font-weight: bold; font-size: 5em; }
    .left-section p { font-size: 2em; }
    .right-section { background: url('img/shrek.jpg') center/cover no-repeat; position: relative; }
    .overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(255, 153, 0, 0.7);
    }
    .login-box {
      background: rgba(0, 0, 0, 0.7);
      padding: 40px;
      width: 550px;
      border-radius: 10px;
      color: #fff;
    }
    hr { height: 3px; background-color: #fff; color: #fff; }
    /* Container card */
.fp-card {
  border: 0;
  border-radius: 16px;
  overflow: hidden;
  box-shadow:
    0 8px 24px rgba(0,0,0,.18),
    0 2px 6px rgba(0,0,0,.08);
  animation: fp-pop .24s ease-out;
}

/* Gradient header */
.fp-header {
  background: linear-gradient(135deg, #ff9d2f 0%, #ff6a00 100%);
  color: #fff;
  border: 0;
  padding: 14px 16px;
}
.fp-header i { font-size: 1.1rem; opacity: .95; }

/* Inputs */
.fp-input-icon {
  background: #fff;
  border: 1px solid #e6e6e6;
  border-right: 0;
  color: #9aa0a6;
}
.fp-input {
  border-left: 0;
  border: 1px solid #e6e6e6;
  padding-top: .6rem;
  padding-bottom: .6rem;
}
.fp-input:focus {
  border-color: #ff9100;
  box-shadow: 0 0 0 .2rem rgba(255,145,0,.15);
}

/* Primary action button (brand-ish orange) */
.fp-btn {
  background: linear-gradient(135deg, #ff9d2f 0%, #ff6a00 100%);
  border: 0;
  color: #fff;
  font-weight: 600;
  padding: .7rem 1rem;
  border-radius: 12px;
  transition: transform .06s ease-in-out, box-shadow .2s ease;
}
.fp-btn:hover { box-shadow: 0 8px 18px rgba(255,106,0,.25); }
.fp-btn:active { transform: translateY(1px); }

/* Footnote */
.fp-footnote {
  font-size: .82rem;
  color: #7a7f85;
}

/* Message styles */
.fp-alert {
  border: 1px solid transparent;
  border-radius: 12px;
  padding: .6rem .75rem;
  font-size: .92rem;
}
.fp-alert-success {
  background: #f3fff6;
  border-color: #b6f0c0;
  color: #1e7f38;
}
.fp-alert-warning {
  background: #fff9f0;
  border-color: #ffe2b9;
  color: #8a5a00;
}
.fp-alert-error {
  background: #fff5f5;
  border-color: #ffc9c9;
  color: #8a1c1c;
}

/* Subtle pop animation */
@keyframes fp-pop {
  from { transform: translateY(4px); opacity: 0; }
  to   { transform: translateY(0);    opacity: 1; }
}

/* Subtle “ghost” link button (looks like text, behaves like a button) */
.link-ghost {
  color: #ffffffcc;            /* soft white over dark card */
  font-weight: 600;
  text-decoration: none;
  border: 0;
  background: transparent;
}
.link-ghost:hover,
.link-ghost:focus {
  color: #fff;
  outline: none;
}

/* Underline slide-in animation */
.underline-slide {
  position: relative;
}
.underline-slide::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;            /* center the underline under the text */
  bottom: -2px;
  margin-inline: auto;
  width: 0%;
  height: 2px;
  background: linear-gradient(135deg, #ff9d2f 0%, #ff6a00 100%);
  transition: width .18s ease-in-out;
}
.underline-slide:hover::after,
.underline-slide:focus::after {
  width: 100%;
}

/* Optional: slightly refine the microcopy color on dark background */
.login-box small.text-muted {
  color: #cfd3d6 !important;
}
/*password stenght admin*/
.strength-weak {
  color: #ef4444; /* red */
  font-weight: 600;
}
.strength-normal {
  color: #f59e0b; /* amber */
  font-weight: 600;
}
.strength-strong {
  color: #22c55e; /* green */
  font-weight: 600;
}

  </style>
</head>
<body>
  <div class="container-fluid h-100">
    <div class="row h-100">
      <!-- Left Section -->
      <div class="col-md-6 left-section">
        <div>
          <h1>R.P HABANA</h1>
          <p>Inventory and Sales Management System</p>
        </div>
      </div>
      
      <!-- Right Section -->
      <div class="col-md-6 right-section d-flex align-items-center justify-content-center">
        <div class="overlay"></div>
        <div class="login-box position-relative">
          <h4 class="text-start">SIGN-IN</h4>
          <hr>
          <form id="loginForm" action="index.php" method="POST">
            <div class="mb-3">
              <i class="fas fa-user"></i>
              <label class="form-label">Username</label>
              <input type="text" id="username" name="username" class="form-control" placeholder="Enter your username" required>
            </div>
            <div class="mb-3">
              <i class="fas fa-lock"></i>
              <label class="form-label">Password</label>
              <input type="password" id="password" name="password" class="form-control" placeholder="Enter your password" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">SIGN-IN</button>
              <div class="d-flex justify-content-between align-items-center mt-3">
                <small class="text-muted">Trouble signing in?</small>
                <button type="button"
                        class="btn btn-link p-0 link-ghost underline-slide d-inline-flex align-items-center gap-2"
                        data-bs-toggle="modal"
                        data-bs-target="#forgotPasswordModal"
                        aria-label="Open password recovery">
                  <i class="fas fa-key" aria-hidden="true"></i>
                  <span>Forgot password</span>
                </button>
                 <button type="button"
                        class="btn btn-link p-0 link-ghost underline-slide d-inline-flex align-items-center gap-2"
                        data-bs-toggle="modal"
                        data-bs-target="#adminRecoveryModal">
                  <i class="fas fa-shield-alt"></i>
                  <span>Admin recovery</span>
                </button>
              </div>
          </form>
        </div>
      </div>
    </div>
  </div>

<!-- Forgot Password Modal for Stockman and Staffs-->
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="forgotPasswordLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-md">
    <div class="modal-content fp-card">
      <div class="modal-header fp-header">
        <div class="d-flex align-items-center gap-2">
          <i class="fas fa-key"></i>
          <h5 class="modal-title mb-0" id="forgotPasswordLabel">Password Recovery</h5>
        </div>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body p-4">
        <form id="forgotPasswordForm" novalidate>
          <div class="mb-2">
            <label for="forgotUsername" class="form-label fw-semibold">Username</label>
            <div class="input-group input-group-lg">
              <span class="input-group-text fp-input-icon"><i class="fas fa-user"></i></span>
              <input type="text" id="forgotUsername" name="username" class="form-control fp-input" placeholder="Enter your username" required>
              <div class="invalid-feedback ps-2">Please enter your username.</div>
            </div>
          </div>

          <div id="forgotPasswordMessage" class="mt-3" role="status" aria-live="polite"></div>

          <button type="submit" class="btn fp-btn w-100 mt-3" id="forgotSubmitBtn">
            <span class="btn-label">Submit Request</span>
            <span class="btn-spinner spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
          </button>

          <div class="fp-footnote text-center mt-3">
            Only Staff & Stockman can request resets. Admins must use the master recovery method.
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!--Admin Reset Modal-->
<div class="modal fade" id="adminRecoveryModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="max-width:520px;">
    <div class="modal-content fp-card">
      <div class="modal-header fp-header">
        <div class="d-flex align-items-center gap-2">
          <i class="fas fa-shield-alt"></i>
          <h5 class="modal-title mb-0">Admin Recovery</h5>
        </div>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4">
        <form id="adminRecoverForm" novalidate>
          <div class="mb-3">
            <label class="form-label fw-semibold">Admin Username</label>
            <div class="input-group input-group-lg">
              <span class="input-group-text fp-input-icon"><i class="fas fa-user-shield"></i></span>
              <input type="text" name="username" class="form-control fp-input" required placeholder="e.g. admin01">
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Master Recovery Code</label>
            <div class="input-group input-group-lg">
              <span class="input-group-text fp-input-icon"><i class="fas fa-key"></i></span>
              <input type="password" name="recovery_code" class="form-control fp-input" required placeholder="Enter master code">
              <button class="input-group-text" type="button" id="toggleAdminCode"><i class="fas fa-eye-slash"></i></button>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">New Password</label>
            <div class="input-group input-group-lg">
              <span class="input-group-text fp-input-icon"><i class="fas fa-lock"></i></span>
              <input type="password" name="new_password" id="admin_new_pw" class="form-control fp-input" required minlength="8" placeholder="New password">
              <button class="input-group-text" type="button" id="toggleAdminNew"><i class="fas fa-eye-slash"></i></button>
            </div>
            <div id="adminStrengthText" class="small mt-2 text-muted">Password strength</div>
          </div>

          <div class="mb-2">
            <label class="form-label fw-semibold">Confirm Password</label>
            <div class="input-group input-group-lg">
              <span class="input-group-text fp-input-icon"><i class="fas fa-check"></i></span>
              <input type="password" name="confirm_password" id="admin_confirm_pw" class="form-control fp-input" required minlength="8" placeholder="Confirm password">
              <button class="input-group-text" type="button" id="toggleAdminConfirm"><i class="fas fa-eye-slash"></i></button>
            </div>
            <div id="adminConfirmText" class="small mt-2 text-muted"></div>
          </div>

          <div id="adminRecoverMessage" class="mt-3"></div>

          <button type="submit" class="btn fp-btn w-100 mt-2" id="adminRecoverBtn">
            <span class="btn-label">Reset Password</span>
            <span class="btn-spinner spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
          </button>

          <div class="fp-footnote text-center mt-3">
            This action is restricted to system administrators with the master recovery code.
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Login validation
    document.getElementById("loginForm").addEventListener("submit", function(event) {
      var username = document.getElementById("username").value;
      var password = document.getElementById("password").value;
      var usernamePattern = /^(?=.*\d)(?=.*[a-zA-Z])[a-zA-Z\d]{6,}$/;

      if (!usernamePattern.test(username)) {
        alert("Username must be at least 6 characters long and contain both letters and numbers.");
        event.preventDefault();
        return;
      }

      if (password.trim() === "") {
        alert("Password cannot be empty.");
        event.preventDefault();
        return;
      }
    });

    // Forgot password for Stockman and Staff AJAX submit
const fpForm = document.getElementById('forgotPasswordForm');
const fpBtn = document.getElementById('forgotSubmitBtn');
const fpSpinner = fpBtn?.querySelector('.btn-spinner');
const fpLabel = fpBtn?.querySelector('.btn-label');
const fpMsg = document.getElementById('forgotPasswordMessage');

fpForm.addEventListener('submit', function(e) {
  e.preventDefault();
  fpSpinner?.classList.remove('d-none');
  fpBtn.disabled = true;
  if (fpLabel) fpLabel.textContent = 'Submitting...';
  fpMsg.innerHTML = '';

  fetch('password_reset.php', { method: 'POST', body: new FormData(fpForm) })
    .then(res => res.json())
    .then(data => {
      const cls =
        data.status === 'success' ? 'fp-alert fp-alert-success' :
        data.status === 'warning' ? 'fp-alert fp-alert-warning' :
        'fp-alert fp-alert-error';
      fpMsg.innerHTML = `<div class="${cls}">${data.message}</div>`;
      if (data.status === 'success') fpForm.reset();
    })
    .catch(() => {
      fpMsg.innerHTML = `<div class="fp-alert fp-alert-error">Something went wrong. Please try again.</div>`;
    })
    .finally(() => {
      fpSpinner?.classList.add('d-none');
      if (fpLabel) fpLabel.textContent = 'Submit Request';
      fpBtn.disabled = false;
    });
});

// Admin Reset Function
(function(){
  const form   = document.getElementById('adminRecoverForm');
  const msg    = document.getElementById('adminRecoverMessage');
  const btn    = document.getElementById('adminRecoverBtn');
  const spin   = btn.querySelector('.btn-spinner');
  const label  = btn.querySelector('.btn-label');

  // Show/hide toggles
  const toggle = (inputEl, btnEl) => {
    btnEl.addEventListener('click', () => {
      const isPw = inputEl.type === 'password';
      inputEl.type = isPw ? 'text' : 'password';
      btnEl.querySelector('i').className = isPw ? 'fas fa-eye' : 'fas fa-eye-slash';
    });
  };
  toggle(document.querySelector('input[name="recovery_code"]'), document.getElementById('toggleAdminCode'));
  toggle(document.getElementById('admin_new_pw'), document.getElementById('toggleAdminNew'));
  toggle(document.getElementById('admin_confirm_pw'), document.getElementById('toggleAdminConfirm'));

  // === Password Strength (Weak / Normal / Strong) ===
  // Add this <div id="adminStrengthText" class="small mt-2 text-muted">Password strength</div> under the New Password field in HTML
  const newPw = document.getElementById('admin_new_pw');
  const strengthText = document.getElementById('adminStrengthText');

  const scoreStrength = (val) => {
    let s = 0;
    if (val.length >= 8) s++;
    if (/[a-z]/.test(val) && /[A-Z]/.test(val)) s++;
    if (/\d/.test(val)) s++;
    if (/[^A-Za-z0-9]/.test(val)) s++; // symbols
    return s; // 0..4
  };

  const setStrengthLabel = (val) => {
    if (!strengthText) return;
    const score = scoreStrength(val);
    // reset classes
    strengthText.classList.remove('strength-weak','strength-normal','strength-strong','text-muted');

    if (score <= 1) {
      strengthText.textContent = 'Strength: Weak';
      strengthText.classList.add('strength-weak');
    } else if (score === 2) {
      strengthText.textContent = 'Strength: Normal';
      strengthText.classList.add('strength-normal');
    } else {
      strengthText.textContent = 'Strength: Strong';
      strengthText.classList.add('strength-strong');
    }
  };

  newPw?.addEventListener('input', () => setStrengthLabel(newPw.value || ''));

  // === Confirm Password Live Match ===
  // Add this <div id="adminConfirmText" class="small mt-2 text-muted"></div> under the Confirm field in HTML (optional)
  const confirmPw = document.getElementById('admin_confirm_pw');
  const confirmText = document.getElementById('adminConfirmText');

  const setConfirmLabel = () => {
    if (!confirmText) return;
    confirmText.classList.remove('text-success','text-danger','text-muted');
    if (!confirmPw.value) {
      confirmText.textContent = '';
      return;
    }
    if (confirmPw.value === newPw.value) {
      confirmText.textContent = 'Passwords match';
      confirmText.classList.add('text-success');
    } else {
      confirmText.textContent = 'Passwords do not match';
      confirmText.classList.add('text-danger');
    }
  };

  newPw?.addEventListener('input', setConfirmLabel);
  confirmPw?.addEventListener('input', setConfirmLabel);

  // === Submit handler ===
  form.addEventListener('submit', function(e){
    e.preventDefault();
    msg.innerHTML = '';
    spin.classList.remove('d-none');
    btn.disabled = true; label.textContent = 'Processing...';

    fetch('admin_recover.php', { method: 'POST', body: new FormData(form) })
      .then(r => r.json())
      .then(d => {
        const cls = d.status === 'success' ? 'fp-alert fp-alert-success'
                  : d.status === 'warning' ? 'fp-alert fp-alert-warning'
                  : 'fp-alert fp-alert-error';
        msg.innerHTML = `<div class="${cls}">${d.message}</div>`;
        if (d.status === 'success') {
          form.reset();
          setStrengthLabel(''); // reset labels
          setConfirmLabel();
          setTimeout(() => {
            const modal = bootstrap.Modal.getInstance(document.getElementById('adminRecoveryModal'));
            modal?.hide();
          }, 1400);
        }
      })
      .catch(() => {
        msg.innerHTML = `<div class="fp-alert fp-alert-error">Something went wrong. Please try again.</div>`;
      })
      .finally(() => {
        spin.classList.add('d-none');
        btn.disabled = false; label.textContent = 'Reset Password';
      });
  });
})();

  </script>
</body>
</html>
